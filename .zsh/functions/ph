if zle; then # called as widget
  BUFFER=$(history -n -r 0 | awk '!a[$0]++' | peco --prompt="HISTORY> " --query="$LBUFFER")
  zle accept-line
  zle redisplay
else
  cmd=$(history -n -r 0 | awk '!a[$0]++' | peco --prompt="HISTORY> " --query="$@")
  eval $cmd
fi
